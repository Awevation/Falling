<html>
    <head>
      <title>Falling</title>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <link rel="stylesheet" href="style/style.css" type="text/css">
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
      <script src="js/jquery.hotkeys.js" type="text/javascript"></script>
      <script src="js/keyStatus.js" type="text/javascript"></script>
      <script src="js/sylvester.js" type="text/javascript"></script>
      <script src="js/glUtils.js" type="text/javascript"></script>
      <script src="js/texture-util.js" type="text/javascript"></script>

      <script src="js/Res.js" type="text/javascript"></script>
      <script src="js/init.js" type="text/javascript"></script>
      <script src="js/Camera.js" type="text/javascript"></script>
      <script src="js/physics.js" type="text/javascript"></script>
      <script src="js/BoundingBox.js" type="text/javascript"></script>
      <script src="js/Timer.js" type="text/javascript"></script>
      <script src="js/Camera.js" type="text/javascript"></script>
      <script src="js/Quad.js" type="text/javascript"></script>
      <script src="js/Cloud.js" type="text/javascript"></script>
      <script src="js/TESTQUAD.js" type="text/javascript"></script>
      <script src="js/Sky.js" type="text/javascript"></script>
      <script src="js/World.js" type="text/javascript"></script>
      <script src="js/Player.js" type="text/javascript"></script>

      <script src="js/main.js" type="text/javascript"></script>

      <script id="shader-vs" type="x-shader/x-vertex">
	  attribute vec3 aVertexPosition;
	  attribute vec2 aTexCo;

	  uniform mat4 uMVMatrix;
	  uniform mat4 uPMatrix;
	  uniform mat4 uMVPMatrix; //TODO Pass in a pre-multiplied matrix

	  varying highp vec2 vTexCo;

	  void main(void) {
	      gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
	      //gl_Position = uMVPMatrix * vec4(aVertexPosition, 1.0);
	      vTexCo = aTexCo;
	  }
      </script>

      <script id="shader-fs" type="x-shader/x-fragment">	  
	  precision mediump float;

      	  varying highp vec2 vTexCo;

	  uniform sampler2D uSampler;

	  void main(void) {
	      gl_FragColor = texture2D(uSampler, vec2(vTexCo.st));
	      if(gl_FragColor.	a < 0.1) {
		  discard;
	      }
	  }			
      </script>

      <script id="blur-shader" type="x-shader/x-fragment">
	  precision highp float;

	  uniform sampler2D uSampler; //The texture

	  varying vec2 vTexCo; //the Vertex Texture Coordinate

	  uniform float vAmount; //How *Much* blurrage? between 0-1 

	  uniform float hAmount;

	  float KernelWeights[3];

	  void main(void) {
	      KernelWeights[0] = 15.0;
	      KernelWeights[1] = 6.0;
	      KernelWeights[2] = 1.0;

	      vec4 sum = texture2D(uSampler, vTexCo) * (20.0 / 64.0);

	      vec2 coord1, coord2;
	      float weight, iFltH, iFltV;

	      for(int i = 0; i < 3; i++) {
		  weight = KernelWeights[i] / 64.0;

		  iFltV = float(i + 1) * vAmount;

	      	  coord1 = vec2(vTexCo.x, vTexCo.y + iFltV);
		  coord2 = vec2(vTexCo.x, vTexCo.y - iFltV);

		  sum += texture2D(uSampler, coord1) * weight;
		  sum += texture2D(uSampler, coord2) * weight;
	      }

	      //TODO, figure out how to do proper Hor + Ver blur

	      gl_FragColor = sum;

	      //Test for Alpha
	      if(gl_FragColor.a < 0.1) {
		  discard;
	      }
	  }
      </script>

    </head>
    
    <body>
	<!--div id="title" class="textBox">
	    <h3>Falling</h3>
	</div-->
	<div id="canvainer">
	    <canvas id="canvas" width="400" height="600">
		Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element. You truly are missing out. I'm so, so sorry.
		Please, http://www.mozilla.org/ or https://www.google.com/chrome/. I wish you all the best in your awesome, canvas filled, HTML5 future.
	    </canvas>
	</div>
    </body>	
</html>
